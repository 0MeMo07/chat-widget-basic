/*! For license information please see 672.chat-widget.js.LICENSE.txt */
"use strict";(this.webpackChunkChatWidget=this.webpackChunkChatWidget||[]).push([[672],{571:(e,t,r)=>{r.d(t,{n:()=>l});var a=r(848),n=r(12),s=r(715),o=r(164),i=r(856);function c(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0,i.QP)((0,o.$)(e))}function l(e){var t=e.children,r=e.as,o=void 0===r?"p":r,i=e.className,l=e.duration,u=void 0===l?2:l,d=e.spread,g=void 0===d?2:d,h=(0,s.P)(o),f=(0,n.useMemo)((function(){return t.length*g}),[t,g]);return(0,a.jsx)(h,{className:c("relative inline-block bg-[length:250%_100%,auto] bg-clip-text","text-transparent [--base-color:#a1a1aa] [--base-gradient-color:#000]","[--bg:linear-gradient(90deg,#0000_calc(50%-var(--spread)),var(--base-gradient-color),#0000_calc(50%+var(--spread)))] [background-repeat:no-repeat,padding-box]","dark:[--base-color:#71717a] dark:[--base-gradient-color:#ffffff] dark:[--bg:linear-gradient(90deg,#0000_calc(50%-var(--spread)),var(--base-gradient-color),#0000_calc(50%+var(--spread)))]",i),initial:{backgroundPosition:"100% center"},animate:{backgroundPosition:"0% center"},transition:{repeat:1/0,duration:u,ease:"linear"},style:{"--spread":"".concat(f,"px"),backgroundImage:"var(--bg), linear-gradient(var(--base-color), var(--base-color))"},children:t})}},661:(e,t,r)=>{r.d(t,{EQ:()=>l,W8:()=>u,o8:()=>s,rD:()=>c});var a=r(888),n=null,s=function(e){n=e},o=function(){return n},i=(0,a.xP)({reducerPath:"chatApi",baseQuery:(0,a.cw)({baseUrl:"https://smake.runasp.net/api/"}),endpoints:function(e){return{createChat:e.mutation({query:function(){return{url:"Semantic/chat/create",method:"POST"}},transformResponse:function(e){return{sessionId:e.chatId||e.sessionId}}}),sendMessage:e.mutation({query:function(e){var t=o();if(!t)throw new Error("No chat session found");return{url:"Semantic/chat/".concat(t),method:"POST",headers:{"Content-Type":"application/json"},body:e}}}),streamMessage:e.mutation({query:function(e){var t=o();if(!t)throw new Error("No chat session found");return{url:"Semantic/chat/".concat(t,"/stream"),method:"POST",headers:{"Content-Type":"application/json",Accept:"text/event-stream"},body:e,responseHandler:"text"}}})}}}),c=i.useCreateChatMutation,l=i.useSendMessageMutation,u=i.useStreamMessageMutation},672:(e,t,r)=>{r.r(t),r.d(t,{default:()=>m});var a=r(848),n=r(12),s=r(715),o=r(221);const i=(0,r(407).A)("message-circle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);var c=r(539),l=r(676),u=r(697),d=r(640),g=r(686),h=r(775),f=r(571),b=r(661),p=function(e,t,r,a){return new(r||(r=Promise))((function(n,s){function o(e){try{c(a.next(e))}catch(e){s(e)}}function i(e){try{c(a.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,i)}c((a=a.apply(e,t||[])).next())}))},x=function(e,t){var r,a,n,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=i(0),o.throw=i(1),o.return=i(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,i[0]&&(s=0)),s;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,a=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){s.label=i[1];break}if(6===i[0]&&s.label<n[1]){s.label=n[1],n=i;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(i);break}n[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},y=function(e,t,r){if(r||2===arguments.length)for(var a,n=0,s=t.length;n<s;n++)!a&&n in t||(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))};function m(){var e=this,t=(0,n.useState)(!1),r=t[0],m=t[1],v=(0,n.useState)([]),w=v[0],j=v[1],k=(0,n.useState)(""),N=k[0],S=k[1],C=(0,n.useState)(!1),A=C[0],P=C[1],M=(0,n.useState)(!1),T=M[0],z=M[1],E=(0,n.useRef)(null),I=(0,b.rD)()[0],O=(0,b.EQ)()[0],D=(0,b.W8)()[0];(0,n.useEffect)((function(){p(e,void 0,void 0,(function(){var e,t;return x(this,(function(a){switch(a.label){case 0:if(!r||T)return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,I().unwrap()];case 2:return e=a.sent(),console.log("Chat session created:",e),(0,b.o8)(e.sessionId),z(!0),j([{sender:"ai",text:"Merhaba! Size nasıl yardımcı olabilirim? Otel aramanızda size yardımcı olmaktan memnuniyet duyarım. 🏨"}]),[3,4];case 3:return t=a.sent(),console.error("Chat initialization failed:",t),[3,4];case 4:return[2]}}))}))}),[r,T]),(0,n.useEffect)((function(){!function(){var e;null===(e=E.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}()}),[w]);var B={toggleButton:A?"bg-blue-500 hover:bg-blue-600":"bg-blue-600 hover:bg-blue-700",chatPanel:A?"bg-gray-900 border-gray-700":"bg-white border-gray-200",header:A?"bg-gray-800 border-gray-700 text-gray-200":"bg-white border-gray-200 text-gray-800",messageArea:A?"bg-gray-900":"bg-gray-50",aiMessage:A?"bg-gray-800 text-gray-200":"bg-gray-100 text-gray-800",userAvatar:A?"bg-gray-800 text-gray-400":"bg-gray-100 text-gray-600",aiAvatar:A?"bg-blue-900 text-blue-400":"bg-blue-100 text-blue-600",hotelCard:A?"bg-gray-800 border-gray-700 text-gray-200":"bg-white border-gray-200 text-gray-800",hotelCardDesc:A?"text-gray-400":"text-gray-500",hotelCardPrice:A?"text-blue-400":"text-blue-600",inputArea:A?"bg-gray-800 border-gray-700":"bg-white border-gray-200",textInput:A?"border-gray-600 bg-gray-700 text-gray-200 placeholder-gray-400":"border-gray-300 bg-white text-gray-800 placeholder-gray-500",sendButton:A?"bg-blue-500 hover:bg-blue-600":"bg-blue-600 hover:bg-blue-700"},W=function(){return p(e,void 0,void 0,(function(){var e,t,r,a,n,s,o,i,c,l,u,d,g,h,f,p,m,v,w,k;return x(this,(function(x){switch(x.label){case 0:if(!N.trim())return[2];e={sender:"user",text:N},t={sender:"ai",text:"Düşünüyorum...",isThinking:!0},j((function(r){return y(y([],r,!0),[e,t],!1)})),S(""),x.label=1;case 1:return x.trys.push([1,10,,16]),[4,D({userMessage:N,systemMessage:"You are a helpful travel assistant."}).unwrap()];case 2:if(!((r=x.sent())instanceof Response))return[3,7];if(!(a=null===(k=r.body)||void 0===k?void 0:k.getReader()))return[3,6];n=new TextDecoder,s="",x.label=3;case 3:return[4,a.read()];case 4:if(o=x.sent(),i=o.done,c=o.value,i)return[3,5];for(s+=n.decode(c,{stream:!0}),l=s.split("\n"),s=l.pop()||"",u=function(e){if(e.startsWith("data: ")){var t=e.slice(6);try{var r=JSON.parse(t);j((function(e){var t=y([],e,!0),a=t[t.length-1];return a.isThinking&&(a.text=r.message||r.content||r,a.isThinking=!1),t}))}catch(e){console.error("Failed to parse SSE data:",e)}}},d=0,g=l;d<g.length;d++)h=g[d],u(h);return[3,3];case 5:if(s)try{f=JSON.parse(s),j((function(e){var t=y([],e,!0),r=t[t.length-1];return r.isThinking&&(r.text=f.message||f.content||f,r.isThinking=!1),t}))}catch(e){console.error("Failed to parse remaining SSE data:",e)}x.label=6;case 6:return[3,9];case 7:return[4,O({userMessage:N,systemMessage:"You are a helpful travel assistant."}).unwrap()];case 8:p=x.sent(),j((function(e){var t=y([],e,!0);return t.pop(),t.push({sender:"ai",text:p.message,suggestions:[]}),t})),x.label=9;case 9:return[3,16];case 10:if(m=x.sent(),console.error("Failed to send message:",m),!(m instanceof Error&&m.message.includes("chat session")))return[3,15];x.label=11;case 11:return x.trys.push([11,14,,15]),[4,I().unwrap()];case 12:return v=x.sent(),(0,b.o8)(v.sessionId),[4,W()];case 13:return x.sent(),[2];case 14:return w=x.sent(),console.error("Failed to create new session:",w),[3,15];case 15:return j((function(e){var t=y([],e,!0);return t.pop(),t.push({sender:"ai",text:"Üzgünüm, bir hata oluştu. Lütfen tekrar deneyin."}),t})),[3,16];case 16:return[2]}}))}))};return(0,a.jsxs)("div",{className:"fixed bottom-6 right-6 z-50",children:[(0,a.jsx)(s.P.button,{onClick:function(){return m(!r)},whileTap:{scale:.9},className:"".concat(B.toggleButton," text-white p-4 rounded-full shadow-xl focus:outline-none transition"),children:(0,a.jsx)(i,{size:24})}),(0,a.jsx)(o.N,{children:r&&(0,a.jsxs)(s.P.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.95},transition:{duration:.3},className:"absolute bottom-16 right-0 w-[380px] h-[600px] ".concat(B.chatPanel," rounded-2xl border shadow-2xl flex flex-col overflow-hidden"),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b ".concat(B.header),children:[(0,a.jsx)("span",{className:"text-lg font-semibold",children:"Seyahat Asistanı"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:function(){P((function(e){return!e}))},className:"".concat(A?"text-gray-400 hover:text-gray-200":"text-gray-500 hover:text-gray-700"," transition"),children:A?(0,a.jsx)(c.A,{size:20}):(0,a.jsx)(l.A,{size:20})}),(0,a.jsx)("button",{onClick:function(){return m(!1)},className:"".concat(A?"text-gray-400 hover:text-gray-200":"text-gray-500 hover:text-gray-700"," transition"),children:(0,a.jsx)(u.A,{size:20})})]})]}),(0,a.jsxs)("div",{className:"flex-1 p-4 overflow-y-auto space-y-4 ".concat(B.messageArea," scroll-smooth"),children:[w.map((function(e,t){return(0,a.jsxs)(s.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex flex-col gap-2",children:[e.text&&(0,a.jsxs)("div",{className:"flex items-start gap-2",children:["ai"===e.sender&&(0,a.jsx)("div",{className:"w-8 h-8 rounded-full ".concat(B.aiAvatar," flex items-center justify-center"),children:(0,a.jsx)(d.A,{size:18})}),(0,a.jsx)("div",{className:"max-w-[80%] px-4 py-2 rounded-xl text-sm ".concat("user"===e.sender?"bg-blue-600 text-white self-end ml-auto":e.isThinking?"self-start":"".concat(B.aiMessage," self-start")),children:e.isThinking?(0,a.jsx)(f.n,{className:"text-sm font-medium",duration:2,spread:1.5,children:e.text}):e.text}),"user"===e.sender&&(0,a.jsx)("div",{className:"w-8 h-8 rounded-full ".concat(B.userAvatar," flex items-center justify-center"),children:(0,a.jsx)(g.A,{size:18})})]}),e.suggestions&&(0,a.jsx)("div",{className:"grid grid-cols-1 gap-3 self-start ml-10",children:e.suggestions.map((function(e,t){return(0,a.jsxs)("div",{className:"".concat(B.hotelCard," rounded-xl overflow-hidden shadow-md hover:shadow-lg transition-shadow duration-300"),children:[(0,a.jsx)("img",{src:e.image,alt:e.title,className:"w-full h-32 object-cover"}),(0,a.jsxs)("div",{className:"p-3 space-y-1",children:[(0,a.jsx)("h4",{className:"text-sm font-semibold",children:e.title}),(0,a.jsx)("p",{className:"text-xs ".concat(B.hotelCardDesc),children:e.description}),(0,a.jsx)("p",{className:"text-sm font-medium ".concat(B.hotelCardPrice),children:e.price})]})]},t)}))})]},t)})),(0,a.jsx)("div",{ref:E})]}),(0,a.jsxs)("div",{className:"p-4 border-t ".concat(B.inputArea," flex items-center gap-2"),children:[(0,a.jsx)("input",{type:"text",className:"flex-1 px-4 py-2 border ".concat(B.textInput," rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 transition"),placeholder:"Bir otel sorusu yazın...",value:N,onChange:function(e){return S(e.target.value)},onKeyDown:function(e){return"Enter"===e.key&&W()}}),(0,a.jsx)("button",{onClick:W,className:"".concat(B.sendButton," text-white rounded-full p-2 transition"),children:(0,a.jsx)(h.A,{size:18})})]})]})})]})}}}]);